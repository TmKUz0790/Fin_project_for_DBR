{##}
{##}
{#{% load static %}#}
{#<!DOCTYPE html>#}
{#<html lang="en">#}
{#<head>#}
{#    <meta charset="UTF-8" />#}
{#    <meta name="viewport" content="width=device-width, initial-scale=1.0" />#}
{#    <title>Прогресс клиента</title>#}
{##}
{#    <!-- CSS -->#}
{#    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">#}
{#    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">#}
{#    <link rel="stylesheet" href="{% static 'css/style.css' %}">#}
{##}
{#    <style>#}
{#        :root {#}
{#            --primary: #2c3e50;#}
{#            --secondary: #34495e;#}
{#            --success: #27ae60;#}
{#            --info: #2980b9;#}
{#            --warning: #f39c12;#}
{#            --danger: #c0392b;#}
{#            --light: #ecf0f1;#}
{#            --dark: #2c3e50;#}
{#            --gold: #C5A572;#}
{#            --royal-blue: #1B3C59;#}
{#            --cream: #F7F3E9;#}
{#        }#}
{##}
{#        body {#}
{#            background: linear-gradient(135deg, var(--royal-blue) 0%, #2c3e50 100%);#}
{#            font-family: 'Playfair Display', 'Inter', -apple-system, BlinkMacSystemFont, serif;#}
{#            color: var(--cream);#}
{#        }#}
{##}
{#        #particles-js {#}
{#            position: fixed;#}
{#            width: 100%;#}
{#            height: 100%;#}
{#            z-index: 0;#}
{#            opacity: 0.6;#}
{#        }#}
{##}
{#        .main_content {#}
{#            position: relative;#}
{#            z-index: 1;#}
{#            padding: 2rem;#}
{#            margin-top: 1rem;#}
{#        }#}
{##}
{#        .card {#}
{#            background: rgba(255, 255, 255, 0.95);#}
{#            border: 2px solid var(--gold);#}
{#            border-radius: 16px;#}
{#            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);#}
{#            transition: all 0.3s ease;#}
{#            position: relative;#}
{#            overflow: hidden;#}
{#        }#}
{##}
{#        .card::before {#}
{#            content: '';#}
{#            position: absolute;#}
{#            top: 0;#}
{#            left: 0;#}
{#            right: 0;#}
{#            height: 4px;#}
{#            background: linear-gradient(90deg, var(--gold) 0%, #E5C687 50%, var(--gold) 100%);#}
{#        }#}
{##}
{#        .card::after {#}
{#            content: '';#}
{#            position: absolute;#}
{#            top: 4px;#}
{#            left: 0;#}
{#            right: 0;#}
{#            bottom: 0;#}
{#            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 100%);#}
{#            pointer-events: none;#}
{#        }#}
{##}
{#        .header-card {#}
{#            padding: 2rem;#}
{#            margin-bottom: 2rem;#}
{#        }#}
{##}
{#        .progress-card {#}
{#            padding: 2rem;#}
{#            margin-bottom: 2rem;#}
{#        }#}
{##}
{#        .table-card {#}
{#            padding: 2rem;#}
{#        }#}
{##}
{#        .table {#}
{#            width: 100%;#}
{#            border-collapse: separate;#}
{#            border-spacing: 0;#}
{#        }#}
{##}
{#        .table th {#}
{#            background: var(--royal-blue);#}
{#            color: var(--gold);#}
{#            font-weight: 600;#}
{#            padding: 1.25rem 1rem;#}
{#            text-transform: uppercase;#}
{#            font-size: 0.875rem;#}
{#            letter-spacing: 0.1em;#}
{#            border-bottom: 2px solid var(--gold);#}
{#        }#}
{##}
{#        .table tr:first-child th:first-child {#}
{#            border-top-left-radius: 12px;#}
{#        }#}
{##}
{#        .table tr:first-child th:last-child {#}
{#            border-top-right-radius: 12px;#}
{#        }#}
{##}
{#        .table td {#}
{#            padding: 1.25rem 1rem;#}
{#            vertical-align: middle;#}
{#            border-bottom: 1px solid rgba(197, 165, 114, 0.2);#}
{#            color: var(--dark);#}
{#            font-size: 0.95rem;#}
{#        }#}
{##}
{#        .table tbody tr {#}
{#            transition: all 0.3s ease;#}
{#        }#}
{##}
{#        .table tbody tr:hover {#}
{#            background: rgba(197, 165, 114, 0.05);#}
{#            transform: translateY(-2px);#}
{#            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);#}
{#        }#}
{##}
{#        .custom-modal {#}
{#            display: none;#}
{#            position: fixed;#}
{#            z-index: 1050;#}
{#            left: 0;#}
{#            top: 0;#}
{#            width: 100%;#}
{#            height: 100%;#}
{#            background-color: rgba(0, 0, 0, 0.5);#}
{#            backdrop-filter: blur(4px);#}
{#        }#}
{##}
{#        .custom-modal-dialog {#}
{#            background: white;#}
{#            margin: 5% auto;#}
{#            width: 90%;#}
{#            max-width: 600px;#}
{#            border-radius: 20px;#}
{#            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);#}
{#            transform: translateY(0);#}
{#            transition: transform 0.3s ease;#}
{#            overflow: hidden;#}
{#            border: 2px solid var(--gold);#}
{#            position: relative;#}
{#        }#}
{##}
{#        .custom-modal-dialog::before {#}
{#            content: '';#}
{#            position: absolute;#}
{#            top: 0;#}
{#            left: 0;#}
{#            right: 0;#}
{#            height: 4px;#}
{#            background: linear-gradient(90deg, var(--gold) 0%, #E5C687 50%, var(--gold) 100%);#}
{#        }#}
{##}
{#        .custom-modal-header {#}
{#            background: var(--royal-blue);#}
{#            color: var(--gold);#}
{#            padding: 1.5rem;#}
{#            border-bottom: 1px solid var(--gold);#}
{#            position: relative;#}
{#        }#}
{##}
{#        .custom-modal-title {#}
{#            margin: 0;#}
{#            font-size: 1.25rem;#}
{#            font-weight: 600;#}
{#        }#}
{##}
{#        .custom-modal-close {#}
{#            background: none;#}
{#            border: none;#}
{#            color: white;#}
{#            font-size: 1.5rem;#}
{#            padding: 0;#}
{#            opacity: 0.8;#}
{#            transition: opacity 0.2s;#}
{#        }#}
{##}
{#        .custom-modal-close:hover {#}
{#            opacity: 1;#}
{#        }#}
{##}
{#        .custom-modal-body {#}
{#            padding: 2rem;#}
{#            font-size: 1rem;#}
{#            line-height: 1.6;#}
{#        }#}
{##}
{#        .custom-modal-footer {#}
{#            padding: 1.5rem;#}
{#            background: #f8f9fa;#}
{#            border-top: 1px solid #eee;#}
{#        }#}
{##}
{#        .btn {#}
{#            padding: 0.625rem 1.25rem;#}
{#            border-radius: 10px;#}
{#            font-weight: 500;#}
{#            transition: all 0.2s;#}
{#        }#}
{##}
{#        .btn-primary {#}
{#            background: var(--primary);#}
{#            border: none;#}
{#        }#}
{##}
{#        .btn-info {#}
{#            background: var(--info);#}
{#            border: none;#}
{#            color: white;#}
{#        }#}
{##}
{#        .btn-secondary {#}
{#            background: #6c757d;#}
{#            border: none;#}
{#        }#}
{##}
{#        .progress-container {#}
{#            background: rgba(236, 240, 241, 0.1);#}
{#            border: 2px solid var(--gold);#}
{#            border-radius: 12px;#}
{#            height: 30px;#}
{#            overflow: hidden;#}
{#            margin: 1.5rem 0;#}
{#            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);#}
{#            position: relative;#}
{#        }#}
{##}
{#        .progress-bar {#}
{#            height: 100%;#}
{#            background: linear-gradient(45deg, var(--gold), #E5C687);#}
{#            transition: width 0.6s ease;#}
{#            display: flex;#}
{#            align-items: center;#}
{#            justify-content: center;#}
{#            color: var(--royal-blue);#}
{#            font-weight: 600;#}
{#            font-size: 1rem;#}
{#            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.3);#}
{#            position: relative;#}
{#            overflow: hidden;#}
{#        }#}
{##}
{#        .progress-bar::after {#}
{#            content: '';#}
{#            position: absolute;#}
{#            top: 0;#}
{#            left: 0;#}
{#            right: 0;#}
{#            bottom: 0;#}
{#            background: linear-gradient(90deg, #}
{#                rgba(255, 255, 255, 0) 0%, #}
{#                rgba(255, 255, 255, 0.3) 50%, #}
{#                rgba(255, 255, 255, 0) 100%);#}
{#            animation: shimmer 2s infinite;#}
{#        }#}
{##}
{#        @keyframes shimmer {#}
{#            0% {#}
{#                transform: translateX(-100%);#}
{#            }#}
{#            100% {#}
{#                transform: translateX(100%);#}
{#            }#}
{#        }#}
{##}
{#        .badge {#}
{#            padding: 0.625rem 1.25rem;#}
{#            border-radius: 8px;#}
{#            font-weight: 600;#}
{#            font-size: 0.875rem;#}
{#            border: 1px solid transparent;#}
{#            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);#}
{#        }#}
{##}
{#        .badge.bg-primary {#}
{#            background: linear-gradient(135deg, var(--royal-blue), var(--primary)) !important;#}
{#            border-color: var(--gold);#}
{#            color: var(--gold);#}
{#        }#}
{##}
{#        .badge.bg-success {#}
{#            background: linear-gradient(135deg, #27ae60, #2ecc71) !important;#}
{#            border-color: #a8e6cf;#}
{#        }#}
{##}
{#        .badge.bg-warning {#}
{#            background: linear-gradient(135deg, #f39c12, #f1c40f) !important;#}
{#            border-color: #ffeaa7;#}
{#            color: var(--dark);#}
{#        }#}
{##}
{#        .badge.bg-danger {#}
{#            background: linear-gradient(135deg, #c0392b, #e74c3c) !important;#}
{#            border-color: #fab1a0;#}
{#        }#}
{##}
{#        .btn {#}
{#            position: relative;#}
{#            overflow: hidden;#}
{#            font-weight: 500;#}
{#            letter-spacing: 0.5px;#}
{#            border: 2px solid transparent;#}
{#            padding: 0.75rem 1.5rem;#}
{#        }#}
{##}
{#        .btn-info, .btn-outline-info {#}
{#            background: var(--royal-blue) !important;#}
{#            color: var(--gold) !important;#}
{#            border-color: var(--gold) !important;#}
{#            transition: all 0.3s ease;#}
{#        }#}
{##}
{#        .btn-info:hover, .btn-outline-info:hover {#}
{#            background: var(--gold) !important;#}
{#            color: var(--royal-blue) !important;#}
{#            transform: translateY(-2px);#}
{#            box-shadow: 0 4px 12px rgba(197, 165, 114, 0.2);#}
{#        }#}
{##}
{#        .action-button {#}
{#            background: var(--royal-blue);#}
{#            color: var(--gold);#}
{#            border: 2px solid var(--gold);#}
{#            padding: 0.875rem 1.75rem;#}
{#            border-radius: 12px;#}
{#            font-weight: 600;#}
{#            letter-spacing: 0.5px;#}
{#            transition: all 0.3s ease;#}
{#            display: flex;#}
{#            align-items: center;#}
{#            gap: 0.75rem;#}
{#        }#}
{##}
{#        .action-button:hover {#}
{#            background: var(--gold);#}
{#            color: var(--royal-blue);#}
{#            transform: translateY(-2px);#}
{#            box-shadow: 0 8px 24px rgba(197, 165, 114, 0.2);#}
{#        }#}
{##}
{#        .actions-container {#}
{#            display: flex;#}
{#            gap: 1rem;#}
{#        }#}
{##}
{#        .action-button {#}
{#            display: flex;#}
{#            align-items: center;#}
{#            gap: 0.5rem;#}
{#            padding: 0.75rem 1.5rem;#}
{#            border-radius: 12px;#}
{#            font-weight: 500;#}
{#            transition: all 0.2s;#}
{#        }#}
{##}
{#        .action-button:hover {#}
{#            transform: translateY(-2px);#}
{#        }#}
{##}
{#        @keyframes modalShow {#}
{#            from {#}
{#                opacity: 0;#}
{#                transform: translateY(-20px);#}
{#            }#}
{#            to {#}
{#                opacity: 1;#}
{#                transform: translateY(0);#}
{#            }#}
{#        }#}
{##}
{#        .modal-open {#}
{#            overflow: hidden;#}
{#        }#}
{##}
{#        .show {#}
{#            animation: modalShow 0.3s ease forwards;#}
{#        }#}
{#    </style>#}
{#</head>#}
{#<body>#}
{#    <div id="particles-js"></div>#}
{##}
{#    <section class="container main_content">#}
{#        <!-- Header Card -->#}
{#        <div class="card header-card">#}
{#            <div class="d-flex justify-content-between align-items-center">#}
{#                <h1 class="h3 mb-0">Прогресс по задаче: {{ job.title }}</h1>#}
{#                <div class="actions-container">#}
{#                    <a href="{% url 'payment_load' %}" class="action-button btn btn-success">#}
{#                        <i class="bi bi-bank"></i>#}
{#                        Платежи#}
{#                    </a>#}
{#                    <a href="{% url 'client_progress_details' %}" class="action-button btn btn-info">#}
{#                        <i class="bi bi-info-circle"></i>#}
{#                        Подробности#}
{#                    </a>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{##}
{#        <!-- Progress Card -->#}
{#        <div class="card progress-card">#}
{#            <h3 class="h5 mb-3">Общий прогресс:</h3>#}
{#            <div class="progress-container">#}
{#                <div class="progress-bar" style="width: {{ job.get_overall_progress }}%">#}
{#                    {{ job.get_overall_progress }}%#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{##}
{#        <!-- Table Card -->#}
{#        <div class="card table-card">#}
{#            <div class="table-responsive">#}
{#                <table class="table">#}
{#                    <thead>#}
{#                        <tr>#}
{#                            <th>№</th>#}
{#                            <th>Название задачи</th>#}
{#                            <th>Описание задачи</th>#}
{#                            <th>Процент выполнения</th>#}
{#                            <th>Прогресс разработчика</th>#}
{#                            <th>Дата начала</th>#}
{#                            <th>Дедлайн</th>#}
{#                            <th>Обратная связь</th>#}
{#                            <th>Статус</th>#}
{#                        </tr>#}
{#                    </thead>#}
{#                    <tbody></tbody>#}
{#                </table>#}
{#            </div>#}
{#        </div>#}
{##}
{#        <!-- Modal Container -->#}
{#        <div id="modalContainer"></div>#}
{#        #}
{#    </section>#}
{##}
{#    <!-- Scripts remain the same as in the previous version -->#}
{#    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>#}
{#    <script src="{% static 'js/particles.min.js' %}"></script>#}
{#    #}
{#    <!-- Keep the exact same JavaScript code here as in the previous version -->#}
{#    <script>#}
{#        // Modal management code (same as before)#}
{#        const createModal = (id) => {#}
{#            return `#}
{#                <div id="${id}" class="custom-modal">#}
{#                    <div class="custom-modal-dialog">#}
{#                        <div class="custom-modal-header">#}
{#                            <h5 class="custom-modal-title"></h5>#}
{#                            <button type="button" class="custom-modal-close" onclick="hideModal('${id}')">&times;</button>#}
{#                        </div>#}
{#                        <div class="custom-modal-body"></div>#}
{#                        <div class="custom-modal-footer">#}
{#                            <button type="button" class="btn btn-secondary" onclick="hideModal('${id}')">Закрыть</button>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#            `;#}
{#        };#}
{##}
{#        const showModal = (modalId, title, content) => {#}
{#            const modal = document.getElementById(modalId);#}
{#            if (!modal) return;#}
{#            #}
{#            modal.querySelector('.custom-modal-title').textContent = title;#}
{#            modal.querySelector('.custom-modal-body').textContent = content;#}
{#            modal.style.display = 'block';#}
{#            document.body.classList.add('modal-open');#}
{##}
{#            // Close on outside click#}
{#            modal.onclick = (event) => {#}
{#                if (event.target === modal) {#}
{#                    hideModal(modalId);#}
{#                }#}
{#            };#}
{#        };#}
{##}
{#        const hideModal = (modalId) => {#}
{#            const modal = document.getElementById(modalId);#}
{#            if (!modal) return;#}
{#            #}
{#            modal.style.display = 'none';#}
{#            document.body.classList.remove('modal-open');#}
{#        };#}
{##}
{#        // Initialize page#}
{#        document.addEventListener("DOMContentLoaded", function () {#}
{#            // Parse tasks data#}
{#            const tasks = JSON.parse('{{ tasks|escapejs }}');#}
{#            console.log('Tasks loaded:', tasks);#}
{##}
{#            // Create modals#}
{#            const modalContainer = document.getElementById('modalContainer');#}
{#            tasks.forEach((_, index) => {#}
{#                modalContainer.innerHTML += createModal(`descriptionModal${index + 1}`);#}
{#                modalContainer.innerHTML += createModal(`feedbackModal${index + 1}`);#}
{#            });#}
{##}
{#            // Handle keyboard events#}
{#            document.addEventListener('keydown', (event) => {#}
{#                if (event.key === 'Enter' || event.key === 'Escape') {#}
{#                    const openModal = document.querySelector('.custom-modal[style*="display: block"]');#}
{#                    if (openModal) {#}
{#                        hideModal(openModal.id);#}
{#                    }#}
{#                }#}
{#            });#}
{##}
{#            // Populate table#}
{#            const tbody = document.querySelector("tbody");#}
{#            tbody.innerHTML = '';#}
{##}
{#            tasks.forEach((task, index) => {#}
{#                // Calculate progress path#}
{#                const startDate = new Date(task.start_date);#}
{#                const deadline = new Date(task.deadline);#}
{#                const currentDate = new Date();#}
{#                const totalDuration = deadline - startDate;#}
{#                const elapsedTime = currentDate - startDate;#}
{#                #}
{#                let path = 0;#}
{#                if (totalDuration <= 0) {#}
{#                    path = 100;#}
{#                } else {#}
{#                    path = Math.min((elapsedTime / totalDuration) * 100, 100);#}
{#                }#}
{##}
{#                // Determine status#}
{#                let statusBadge;#}
{#                if (task.progress >= path) {#}
{#                    statusBadge = `<span class="badge bg-primary">Перевыполнено на ${(task.progress - path).toFixed(2)}%</span>`;#}
{#                } else if (task.progress >= path - 5) {#}
{#                    statusBadge = `<span class="badge bg-warning">Отставание 5%</span>`;#}
{#                } else if (task.progress >= path - 10) {#}
{#                    statusBadge = `<span class="badge bg-danger">Отставание 10%</span>`;#}
{#                } else {#}
{#                    statusBadge = `<span class="badge bg-success">По плану</span>`;#}
{#                }#}
{##}
{#                // Create row#}
{#                const row = document.createElement("tr");#}
{#                row.innerHTML = `#}
{#                    <td>${index + 1}</td>#}
{#                    <td class="taskTitle">${task.title}</td>#}
{#                    <td>#}
{#                        <button class="btn btn-sm btn-info" onclick="showModal('descriptionModal${index + 1}', 'Описание задачи: ${task.title}', '${(task.description || 'Описание отсутствует').replace(/'/g, "&#39;")}')">#}
{#                            Описание#}
{#                        </button>#}
{#                    </td>#}
{#                    <td>${task.task_percentage}%</td>#}
{#                    <td class="taskProgress">${task.progress}%</td>#}
{#                    <td>${task.start_date || '-'}</td>#}
{#                    <td>${task.deadline || '-'}</td>#}
{#                    <td>#}
{#                        <button class="btn btn-sm btn-outline-info" onclick="showModal('feedbackModal${index + 1}', 'Отзыв для задачи: ${task.title}', '${(task.feedback || 'Отзыв отсутствует').replace(/'/g, "&#39;")}')">#}
{#                            FeedBack#}
{#                        </button>#}
{#                    </td>#}
{#                    <td>${statusBadge}</td>#}
{#                `;#}
{#                tbody.appendChild(row);#}
{#            });#}
{#        });#}
{#        // Initialize particles#}
{#        const particlesConfigUrl = "{% static 'assets/particles.json' %}";#}
{#        particlesJS.load('particles-js', particlesConfigUrl, function() {#}
{#            console.log('Particles.js loaded');#}
{#        });#}
{#    </script>#}
{##}
{#    <!-- Additional Scripts -->#}
{#    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>#}
{#    <script src="https://cdn.amcharts.com/lib/5/percent.js"></script>#}
{#    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>#}
{#    <script src="{% static 'js/chart.js' %}"></script>#}
{#    <script src="{% static 'js/app.js' %}"></script>#}
{#    <script src="{% static 'js/script.js' %}"></script>#}
{#</body>#}
{#</html>#}


{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Прогресс клиента</title>

    <!-- CSS Dependencies -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">

    <style>
        :root {
            --primary: #1a1a1a;
            --secondary: #2d2d2d;
            --accent: #B8860B;
            --accent-light: #DAA520;
            --text: #FFFFFF;
            --text-dark: #1a1a1a;
            --surface: #2d2d2d;
            --surface-light: #3d3d3d;
            --background: #121212;
        }

        body {
            background: linear-gradient(135deg, var(--background) 0%, var(--surface) 100%);
            font-family: 'Montserrat', sans-serif;
            color: var(--text);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Cormorant Garamond', serif;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.4;
            pointer-events: none;
        }

        .main_content {
            position: relative;
            z-index: 1;
            padding: 2.5rem;
            margin-top: 2rem;
        }

        /* Card Styles */
        .card {
            background: rgba(45, 45, 45, 0.95);
            border: 1px solid var(--accent);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
            backdrop-filter: blur(10px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent) 0%, var(--accent-light) 50%, var(--accent) 100%);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(184, 134, 11, 0.2);
        }

        /* Header Card */
        .header-card {
            padding: 2.5rem;
            margin-bottom: 2.5rem;
        }

        .header-card h1 {
            color: var(--accent-light);
            font-size: 2.5rem;
            margin-bottom: 0;
            letter-spacing: 0.5px;
        }

        /* Progress Card */
        .progress-card {
            padding: 2.5rem;
            margin-bottom: 2.5rem;
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--accent);
            border-radius: 15px;
            height: 35px;
            overflow: hidden;
            margin: 2rem 0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(45deg, var(--accent), var(--accent-light));
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text);
            font-weight: 600;
            font-size: 1.1rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                rgba(255, 255, 255, 0) 0%, 
                rgba(255, 255, 255, 0.2) 50%, 
                rgba(255, 255, 255, 0) 100%);
            animation: shimmer 2s infinite;
        }

        /* Table Styles */
        .table-card {
            padding: 2.5rem;
        }

        .table {
            width: 100%;
            margin-bottom: 0;
            color: var(--text);
            border-collapse: separate;
            border-spacing: 0;
        }

        .table th {
            background: var(--surface);
            color: var(--accent-light);
            font-family: 'Cormorant Garamond', serif;
            font-weight: 600;
            font-size: 1.1rem;
            padding: 1.5rem 1rem;
            border-bottom: 2px solid var(--accent);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .table td {
            padding: 1.25rem 1rem;
            vertical-align: middle;
            border-bottom: 1px solid rgba(184, 134, 11, 0.2);
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .table tbody tr {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(45, 45, 45, 0.7);
        }

        .table tbody tr:hover {
            background: rgba(184, 134, 11, 0.1);
            transform: scale(1.01);
        }

        /* Button Styles */
        .action-button {
            background: transparent;
            color: var(--accent-light);
            border: 2px solid var(--accent);
            padding: 0.875rem 1.75rem;
            border-radius: 12px;
            font-weight: 500;
            letter-spacing: 1px;
            text-transform: uppercase;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
        }

        .action-button:hover {
            background: var(--accent);
            color: var(--text);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(184, 134, 11, 0.3);
        }

        .btn-info, .btn-outline-info {
            background: transparent;
            color: var(--accent-light);
            border: 1px solid var(--accent);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 0.625rem 1.25rem;
            border-radius: 8px;
        }

        .btn-info:hover, .btn-outline-info:hover {
            background: var(--accent);
            color: var(--text);
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        /* Badge Styles */
        .badge {
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-weight: 500;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .badge.bg-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-light)) !important;
            color: var(--text);
        }

        .badge.bg-warning {
            background: linear-gradient(135deg, #FF8C00, #FFA500) !important;
            color: var(--text-dark);
        }

        .badge.bg-danger {
            background: linear-gradient(135deg, #8B0000, #DC143C) !important;
            color: var(--text);
        }

        .badge.bg-success {
            background: linear-gradient(135deg, #006400, #228B22) !important;
            color: var(--text);
        }

        /* Modal Styles */
        .custom-modal {
            display: none;
            position: fixed;
            z-index: 1050;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .custom-modal-dialog {
            background: var(--surface);
            margin: 5% auto;
            width: 90%;
            max-width: 600px;
            border-radius: 20px;
            border: 1px solid var(--accent);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            transform: translateY(0);
            transition: transform 0.3s ease;
            overflow: hidden;
        }

        .custom-modal-header {
            background: var(--surface-light);
            padding: 1.5rem;
            border-bottom: 1px solid var(--accent);
            position: relative;
        }

        .custom-modal-title {
            color: var(--accent-light);
            font-family: 'Cormorant Garamond', serif;
            margin: 0;
            font-size: 1.5rem;
        }

        .custom-modal-close {
            background: none;
            border: none;
            color: var(--accent-light);
            font-size: 1.5rem;
            padding: 0;
            opacity: 0.8;
            transition: opacity 0.2s;
            position: absolute;
            right: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
        }

        .custom-modal-close:hover {
            opacity: 1;
            color: var(--accent);
        }

        .custom-modal-body {
            padding: 2rem;
            color: var(--text);
            font-size: 1rem;
            line-height: 1.6;
        }

        .custom-modal-footer {
            padding: 1.5rem;
            background: var(--surface-light);
            border-top: 1px solid var(--accent);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* Animations */
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes modalShow {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .show {
            animation: modalShow 0.3s ease forwards;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .main_content {
                padding: 1rem;
            }

            .header-card h1 {
                font-size: 2rem;
            }

            .action-button {
                padding: 0.75rem 1.25rem;
                font-size: 0.9rem;
            }

            .table th {
                font-size: 1rem;
                padding: 1rem;
            }

            .table td {
                font-size: 0.9rem;
                padding: 1rem;
            }

            .badge {
                padding: 0.5rem 1rem;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div id="particles-js"></div>

    <section class="container main_content">
        <!-- Header Card -->
        <div class="card header-card">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="h3 mb-0">Прогресс по задаче: {{ job.title }}</h1>
                <div class="actions-container">
                    <a href="{% url 'payment_load' %}" class="action-button">
                        <i class="bi bi-bank"></i>
                        Платежи
                    </a>
                    <a href="{% url 'client_progress_details' %}" class="action-button">
                        <i class="bi bi-info-circle"></i>
                        Подробности
                    </a>
                </div>
            </div>
        </div>

        <!-- Progress Card -->
        <div class="card progress-card">
            <h3 class="h5 mb-3">Общий прогресс:</h3>
            <div class="progress-container">
                <div class="progress-bar" style="width: {{ job.get_overall_progress }}%">
                    {{ job.get_overall_progress }}%
                </div>
            </div>
        </div>

        <!-- Table Card -->
        <div class="card table-card">
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>№</th>
                            <th>Название задачи</th>
                            <th>Описание задачи</th>
                            <th>Процент выполнения</th>
                            <th>Прогресс разработчика</th>
                            <th>Дата начала</th>
                            <th>Дедлайн</th>
                            <th>Обратная связь</th>
                            <th>Статус</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Modal Container -->
        <div id="modalContainer"></div>
        
    </section>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'js/particles.min.js' %}"></script>
    
    <script>
        // Modal Management
        const createModal = (id) => {
            return `
                <div id="${id}" class="custom-modal">
                    <div class="custom-modal-dialog">
                        <div class="custom-modal-header">
                            <h5 class="custom-modal-title"></h5>
                            <button type="button" class="custom-modal-close" onclick="hideModal('${id}')">&times;</button>
                        </div>
                        <div class="custom-modal-body"></div>
                        <div class="custom-modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="hideModal('${id}')">Закрыть</button>
                        </div>
                    </div>
                </div>
            `;
        };

        const showModal = (modalId, title, content) => {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            
            modal.querySelector('.custom-modal-title').textContent = title;
            modal.querySelector('.custom-modal-body').textContent = content;
            modal.style.display = 'block';
            document.body.classList.add('modal-open');
            modal.classList.add('show');

            // Close on outside click
            modal.onclick = (event) => {
                if (event.target === modal) {
                    hideModal(modalId);
                }
            };
        };

        const hideModal = (modalId) => {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            
            modal.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
                document.body.classList.remove('modal-open');
            }, 300);
        };

        // Initialize page
        document.addEventListener("DOMContentLoaded", function () {
            // Parse tasks data
            const tasks = JSON.parse('{{ tasks|escapejs }}');
            console.log('Tasks loaded:', tasks);

            // Create modals
            const modalContainer = document.getElementById('modalContainer');
            tasks.forEach((_, index) => {
                modalContainer.innerHTML += createModal(`descriptionModal${index + 1}`);
                modalContainer.innerHTML += createModal(`feedbackModal${index + 1}`);
            });

            // Handle keyboard events
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Enter' || event.key === 'Escape') {
                    const openModal = document.querySelector('.custom-modal[style*="display: block"]');
                    if (openModal) {
                        hideModal(openModal.id);
                    }
                }
            });

            // Populate table
            const tbody = document.querySelector("tbody");
            tbody.innerHTML = '';

            tasks.forEach((task, index) => {
                // Calculate progress path
                const startDate = new Date(task.start_date);
                const deadline = new Date(task.deadline);
                const currentDate = new Date();
                const totalDuration = deadline - startDate;
                const elapsedTime = currentDate - startDate;
                
                let path = 0;
                if (totalDuration <= 0) {
                    path = 100;
                } else {
                    path = Math.min((elapsedTime / totalDuration) * 100, 100);
                }

                // Determine status
                let statusBadge;
                if (task.progress >= path) {
                    statusBadge = `<span class="badge bg-primary">Перевыполнено на ${(task.progress - path).toFixed(2)}%</span>`;
                } else if (task.progress >= path - 5) {
                    statusBadge = `<span class="badge bg-warning">Отставание 5%</span>`;
                } else if (task.progress >= path - 10) {
                    statusBadge = `<span class="badge bg-danger">Отставание 10%</span>`;
                } else {
                    statusBadge = `<span class="badge bg-success">По плану</span>`;
                }

                // Create row
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td class="taskTitle">${task.title}</td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="showModal('descriptionModal${index + 1}', 'Описание задачи: ${task.title}', '${(task.description || 'Описание отсутствует').replace(/'/g, "&#39;")}')">
                            Описание
                        </button>
                    </td>
                    <td>${task.task_percentage}%</td>
                    <td class="taskProgress">${task.progress}%</td>
                    <td>${task.start_date || '-'}</td>
                    <td>${task.deadline || '-'}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-info" onclick="showModal('feedbackModal${index + 1}', 'Отзыв для задачи: ${task.title}', '${(task.feedback || 'Отзыв отсутствует').replace(/'/g, "&#39;")}')">
                            FeedBack
                        </button>
                    </td>
                    <td>${statusBadge}</td>
                `;
                tbody.appendChild(row);
            });
        });

        // Initialize particles
        particlesJS.load('particles-js', "{% static 'assets/particles.json' %}", function() {
            console.log('Particles.js loaded');
        });
    </script>

    <!-- Additional Scripts -->
    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/percent.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
    <script src="{% static 'js/chart.js' %}"></script>
    <script src="{% static 'js/app.js' %}"></script>
    <script src="{% static 'js/script.js' %}"></script>
</body>
</html>
        